<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Notes d&#39;apprentissage de Python : traitement des séquences avec un style fonctionnel - flatmap - The Geek In The Shell</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="TGITS" /><meta name="description" content="Contexte Ce billet s&amp;rsquo;inscrit dans une série de billets sur le traitement des séquences avec un style fonctionnel en Python.
NB : La version de Python utilisée dans les exemples de code est la version 3.
Pour pleinement profiter de ce billet, il faut que vous connaissiez déjà le fonctionnement de map et reduce en Python ou que vous lisiez d&amp;rsquo;abord les billets que j&amp;rsquo;ai écrit sur l&amp;rsquo;un et l&amp;rsquo;autre." /><meta name="keywords" content="TGITS, Développement, Java, Architecture" />






<meta name="generator" content="Hugo 0.71.1 with theme even" />


<link rel="canonical" href="https://tgits.github.io/post/notes_apprentissage_python_tssf_flatmap/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Notes d&#39;apprentissage de Python : traitement des séquences avec un style fonctionnel - flatmap" />
<meta property="og:description" content="Contexte Ce billet s&rsquo;inscrit dans une série de billets sur le traitement des séquences avec un style fonctionnel en Python.
NB : La version de Python utilisée dans les exemples de code est la version 3.
Pour pleinement profiter de ce billet, il faut que vous connaissiez déjà le fonctionnement de map et reduce en Python ou que vous lisiez d&rsquo;abord les billets que j&rsquo;ai écrit sur l&rsquo;un et l&rsquo;autre." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tgits.github.io/post/notes_apprentissage_python_tssf_flatmap/" />
<meta property="article:published_time" content="2021-05-07T14:27:47+02:00" />
<meta property="article:modified_time" content="2021-05-07T14:27:47+02:00" />
<meta itemprop="name" content="Notes d&#39;apprentissage de Python : traitement des séquences avec un style fonctionnel - flatmap">
<meta itemprop="description" content="Contexte Ce billet s&rsquo;inscrit dans une série de billets sur le traitement des séquences avec un style fonctionnel en Python.
NB : La version de Python utilisée dans les exemples de code est la version 3.
Pour pleinement profiter de ce billet, il faut que vous connaissiez déjà le fonctionnement de map et reduce en Python ou que vous lisiez d&rsquo;abord les billets que j&rsquo;ai écrit sur l&rsquo;un et l&rsquo;autre.">
<meta itemprop="datePublished" content="2021-05-07T14:27:47&#43;02:00" />
<meta itemprop="dateModified" content="2021-05-07T14:27:47&#43;02:00" />
<meta itemprop="wordCount" content="3805">



<meta itemprop="keywords" content="python,python3,notes d&#39;apprentissage,développement,tips,programmation fonctionnelle," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Notes d&#39;apprentissage de Python : traitement des séquences avec un style fonctionnel - flatmap"/>
<meta name="twitter:description" content="Contexte Ce billet s&rsquo;inscrit dans une série de billets sur le traitement des séquences avec un style fonctionnel en Python.
NB : La version de Python utilisée dans les exemples de code est la version 3.
Pour pleinement profiter de ce billet, il faut que vous connaissiez déjà le fonctionnement de map et reduce en Python ou que vous lisiez d&rsquo;abord les billets que j&rsquo;ai écrit sur l&rsquo;un et l&rsquo;autre."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">TGITS</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Blog</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">TGITS</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Blog</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Notes d&#39;apprentissage de Python : traitement des séquences avec un style fonctionnel - flatmap</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-05-07 </span>
        <div class="post-category">
            <a href="/categories/d%C3%A9veloppement/"> développement </a>
            <a href="/categories/python/"> python </a>
            <a href="/categories/notes-dapprentissage/"> notes d&#39;apprentissage </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contenu</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#contexte">Contexte</a></li>
    <li><a href="#le-besoin">Le besoin</a></li>
    <li><a href="#vers-flatmap-et-au-delà">Vers flatmap et au-delà</a></li>
    <li><a href="#itertools-for-the-win">Itertools for the win</a>
      <ul>
        <li><a href="#et-splat-le-chien">Et splat le chien</a></li>
        <li><a href="#iterator-unchained">Iterator unchained</a></li>
        <li><a href="#product">Product</a></li>
        <li><a href="#ne-pas-confondre-flatmap-et-flatten">Ne pas confondre flatmap et flatten</a></li>
      </ul>
    </li>
    <li><a href="#synthèse">Synthèse</a></li>
    <li><a href="#ressources">Ressources</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="contexte">Contexte</h2>
<p>Ce billet s&rsquo;inscrit dans une <a href="https://tgits.github.io/post/notes_apprentissage_python_traiter_sequences_avec_style_fonctionnel/">série de billets sur le traitement des séquences avec un style fonctionnel en Python</a>.</p>
<p><strong>NB</strong> : La version de Python utilisée dans les exemples de code est la version 3.</p>
<p>Pour pleinement profiter de ce billet, il faut que vous connaissiez déjà le fonctionnement de <code>map</code> et <code>reduce</code> en Python ou que vous lisiez d&rsquo;abord les billets que j&rsquo;ai écrit sur <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_map/">l&rsquo;un</a> et <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_reduce/">l&rsquo;autre</a>.</p>
<h2 id="le-besoin">Le besoin</h2>
<p>Dans les billets précédents sur <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_filter/">filter</a>, <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_map/">map</a> et <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_reduce/">reduce</a>, nous avons vu des fonctions natives ou pas qui existent en Python et permettent d&rsquo;écrire du code avec un style fonctionnel.</p>
<p>Dans le billet sur <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_map/">map</a>, nous avons comparé cette fonction à l&rsquo;utilisation des compréhensions (qui lui sont souvent préférées en Python) en comparant par rapport aux exemples du <a href="notes_apprentissage_python_comprehension">billet qui leur était dédié</a>.</p>
<p>Néanmoins, dans ce billet nous avions le cas d&rsquo;une compréhension imbriquée pour représenter un échiquier sous la forme d&rsquo;un tableau de pairs colonnes et lignes :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">chessboard</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">chessboard</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8), (&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), (&#39;b&#39;, 6), (&#39;b&#39;, 7), (&#39;b&#39;, 8), (&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8), (&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), (&#39;d&#39;, 6), (&#39;d&#39;, 7), (&#39;d&#39;, 8), (&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8), (&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 7), (&#39;f&#39;, 8), (&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8), (&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]
</code></pre></td></tr></table>
</div>
</div><p>Comment obtenir la même chose avec <code>map</code> ?</p>
<h2 id="vers-flatmap-et-au-delà">Vers flatmap et au-delà</h2>
<p>Dans un premier temps pourquoi ne pas partir sur une approche naïve dans laquelle on va avoir des fonctions <code>map</code> imbriquées, tout comme on a des boucles <code>for</code> imbriquée ?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="s2">&#34;Approche naïve (1) : &#34;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">rows</span><span class="p">),</span> <span class="n">columns</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><p>Cela nous donne une liste d&rsquo;objets <code>map</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">Approche</span> <span class="n">naïve</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>  <span class="p">[</span><span class="o">&lt;</span><span class="nb">map</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000023F25AE9CA0</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000023F25AE9070</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000023F25AE6FD0</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000023F25AE6310</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000023F25AE6190</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000023F25D54C40</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000023F25D54CD0</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000023F25D54C10</span><span class="o">&gt;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>Transformons ces objets <code>map</code> en des listes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="s2">&#34;Approche naïve (2) : &#34;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">rows</span><span class="p">)),</span> <span class="n">columns</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><p>Nous obtenons, une liste de listes de pairs, ces dernières correspondant à ce que l&rsquo;on souhaite comme données. Seulement on souhaiterait juste avoir une liste de pairs, pas une liste de liste de pairs.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Approche naïve (2) :  [[(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8)], [(&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), (&#39;b&#39;, 6), (&#39;b&#39;, 7), 
(&#39;b&#39;, 8)], [(&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8)], [(&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), (&#39;d&#39;, 6), (&#39;d&#39;, 7), (&#39;d&#39;, 8)], [(&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8)], [(&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 7), (&#39;f&#39;, 8)], [(&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8)], [(&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]]
</code></pre></td></tr></table>
</div>
</div><p>Avec la fonction <code>map</code>, on le voit l&rsquo;implémentation ne va pas être directe et va demander d&rsquo;utiliser d&rsquo;autres fonctions. Dans le cadre d&rsquo;une approche fonctionnelle, pour obtenir une solution élégante il faudrait s&rsquo;appuyer sur une fonction de la forme <code>flatmap</code> en faisant un <code>flatmap</code> appelant le <code>map</code>. Le soucis est que la fonction <code>flatmap</code> n&rsquo;existe pas en Python. Cependant Python ne nous laisse pas dépourvu de solutions pour arriver à nos fins.</p>
<p>Néanmoins avant tout chose peut-être un mot sur <code>flatmap</code>. Avec <code>map</code> vous transformez une séquence en une nouvelle séquence dans laquelle chaque élément est le résultat de l&rsquo;appel de la fonction passée en paramètre.</p>
<p>Par exemple, avec une fonction très simple qui ajoute 1, exprimée sous forme de lambda sur la séquence des nombres de 0 à 9, on obtient la séquence des nombres de 1 à 10 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">sequence_1</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sequence_1</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
</code></pre></td></tr></table>
</div>
</div><p>Je sais, je radote, j&rsquo;ai déjà expliqué la fonction <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_map/">map</a> : c&rsquo;est juste un petit rappel pour arriver à <code>flatmap</code>.</p>
<p>Maintenant, modifions la fonction pour qu&rsquo;elle retourne une paire avec la valeur passée en paramètre et cette valeur plus un :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">sequence_2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sequence_2</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Cette fois-ci, on n&rsquo;obtient plus une séquence de nombres, mais une séquence de liste de nombres</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[[0, 1], [1, 2], [2, 3], [3, 4], [4, 5], [5, 6], [6, 7], [7, 8], [8, 9], [9, 10]]
</code></pre></td></tr></table>
</div>
</div><p>Ce n&rsquo;est pas forcément gênant mais si ce que vous souhaitez exploiter au final c&rsquo;est une liste de nombres et non une liste de listes de nombres, il y a un peu de travail à effectuer sur cette liste, pour <em>l&rsquo;aplatir</em>, c&rsquo;est-à-dire supprimer le niveau d&rsquo;imbrication et obtenir la liste <code>[0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10]</code>. C&rsquo;est là où on pourrait utiliser <code>flatmap</code> si la fonction existait en Python. Cela donnerait ceci :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">sequence_3</span> <span class="o">=</span> <span class="n">flatmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sequence_3</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>qui aurait comme résultat :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10]
</code></pre></td></tr></table>
</div>
</div><p>Le fonction <code>flatmap</code> applique la fonction qui lui est passée en paramètre comme la fonction <code>map</code> mais concatène le résultat au reste de la séquence plutôt que de l&rsquo;ajouter dans la séquence.</p>
<p>Si on essaie d&rsquo;être un peu plus formel, la fonction <code>map</code> :</p>
<ul>
<li>prend en paramètre
<ul>
<li>une fonction qui en paramètre un élément de type <strong>A</strong> et qui le transforme en élément de type <strong>B</strong></li>
<li>une séquence d&rsquo;éléments de type <strong>A</strong></li>
</ul>
</li>
<li>fournit en résultat une séquence d&rsquo;éléments de type <strong>B</strong></li>
</ul>
<p>La fonction <code>flatmap</code> :</p>
<ul>
<li>prend en paramètre
<ul>
<li>une fonction qui en paramètre un élément de type <strong>A</strong> et qui le transforme en élément de type <strong>Liste de B</strong></li>
<li>une séquence d&rsquo;éléments de type <strong>A</strong></li>
</ul>
</li>
<li>fournit en résultat une séquence d&rsquo;éléments de type <strong>B</strong></li>
</ul>
<p>La fonction <code>flatmap</code> est importante dans les langages fonctionnelles et se retrouve au coeur de la notion de <em>monade</em>.</p>
<p>Maintenant que nous avons défini ce qu&rsquo;est <code>flatmap</code>, comment peut-on l&rsquo;implémenter en Python ?</p>
<p>Dans un premier temps revenons à notre problème concret avec l&rsquo;échiquier.</p>
<p>Le résultat obtenu n&rsquo;était pas si loin que cela de la cible. Il nous faudrait un moyen d&rsquo;aplatir le résultat ou de concaténer l&rsquo;ensemble des listes pour n&rsquo;en faire qu&rsquo;une.
Tiens d&rsquo;ailleurs dans certains langgaes (comme <a href="https://clojure.org/">Clojure</a>), la fonction s&rsquo;appelle <a href="https://clojuredocs.org/clojure.core/mapcat">mapcat</a> et non <code>flatmap</code>.
Cela peut nous donner des pistes.
En effet, dans le module <code>operator</code> de Python on peut remarquer <code>iconcat</code> qui correspond à <code>+=</code> pour des séquences.
Cela correspond bien à notre besoin : une fonction qui concatène deux séquences et retourne le résultat.
Il faudrait maintenant une fonction qui nous permette d&rsquo;appliquer cette concaténation successivement à chaque liste dans la liste.
La fonction <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_reduce/">reduce</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">operator</span>


<span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">chessboard</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">iconcat</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">rows</span><span class="p">),</span> <span class="n">columns</span><span class="p">),</span> <span class="p">[])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Liste des cases de l&#39;échiquier avec map, reduce et iconcat :&#34;</span><span class="p">,</span> <span class="n">chessboard</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Cela nous donne bien le résultat attendu :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Liste des cases de l&#39;échiquier avec map, reduce et iconcat : [(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8), (&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), (&#39;b&#39;, 6), (&#39;b&#39;, 7), (&#39;b&#39;, 8), (&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8), (&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), 
(&#39;d&#39;, 6), (&#39;d&#39;, 7), (&#39;d&#39;, 8), (&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8), (&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 
7), (&#39;f&#39;, 8), (&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8), (&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]
</code></pre></td></tr></table>
</div>
</div><p>Pour bien comprendre comment cela fonctionne, revenons au résultat avec l&rsquo;approche naïve :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[[(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8)], [(&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), (&#39;b&#39;, 6), (&#39;b&#39;, 7), 
(&#39;b&#39;, 8)], [(&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8)], [(&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), (&#39;d&#39;, 6), (&#39;d&#39;, 7), (&#39;d&#39;, 8)], [(&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8)], [(&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 7), (&#39;f&#39;, 8)], [(&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8)], [(&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]]
</code></pre></td></tr></table>
</div>
</div><p>On a une liste de listes.
Avec <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_reduce/">reduce</a>, nous parcourons cette liste élément après élément, c&rsquo;est-à-dire ici liste après liste, et nous les concaténons les unes après les autres avec la valeur obtenue à l&rsquo;étape précédente, la valeur initiale étant la liste vide.</p>
<p>Cela nous guide vers une implémentation possible de flatmap.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">operator</span>


<span class="k">def</span> <span class="nf">functional_flatmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">iterator</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">iconcat</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">iterator</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Le paramètre <code>fun</code> est une fonction qui prend un paramètre correspondant au type produit par un <code>iterator</code> et retourne une <code>list</code>.
On peut la tester sur la génération du tableau de l&rsquo;échiquier.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">chessboard</span> <span class="o">=</span> <span class="n">functional_flatmap</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">rows</span><span class="p">)),</span> <span class="n">columns</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Liste des cases de l&#39;échiquier avec functional_flatmap :&#34;</span><span class="p">,</span> <span class="n">chessboard</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Liste des cases de l&#39;échiquier avec functional_flatmap : [(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8), (&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), (&#39;b&#39;, 6), (&#39;b&#39;, 7), (&#39;b&#39;, 8), (&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8), (&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), (&#39;d&#39;, 6), (&#39;d&#39;, 7), (&#39;d&#39;, 8), (&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8), (&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 7), 
(&#39;f&#39;, 8), (&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8), (&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]       
</code></pre></td></tr></table>
</div>
</div><p>Ce qui nous donne bien le résultat attendu.
Cependant on notera que notre fonction <code>fun</code> doit retourner une liste ou du moins un type compatible avec <code>operator.iconcat</code>.</p>
<p>On peut bien sûr faire une version de <code>flatmap</code> impérative qui retournera elle-aussi une liste.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">imperative_flatmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">iterator</span><span class="p">):</span>
    <span class="n">resulting_iterator</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
        <span class="n">resulting_iterator</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">resulting_iterator</span>
</code></pre></td></tr></table>
</div>
</div><p>Si on l&rsquo;applique à la génération de la liste des cases de l&rsquo;échiquier :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">chessboard</span> <span class="o">=</span> <span class="n">imperative_flatmap</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">rows</span><span class="p">)),</span> <span class="n">columns</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Liste des cases de l&#39;échiquier avec imperative_flatmap :&#34;</span><span class="p">,</span> <span class="n">chessboard</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>On obtient un résultat similaire.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Liste des cases de l&#39;échiquier avec imperative_flatmap : [(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8), (&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), (&#39;b&#39;, 6), (&#39;b&#39;, 7), (&#39;b&#39;, 8), (&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8), (&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), (&#39;d&#39;, 6), (&#39;d&#39;, 7), (&#39;d&#39;, 8), (&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8), (&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 7), 
(&#39;f&#39;, 8), (&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8), (&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]       
</code></pre></td></tr></table>
</div>
</div><p>Néanmoins si ces solutions sont intéressantes car elles nous permettent de comprendre le fonctionnement de <code>flatmap</code> et de voir pour la version fonctionnelle une exemple de combinaison de <code>reduce</code> et <code>map</code>, elles ne sont pas pleinement satisfaisantes.</p>
<p>Nous allons voir comment <code>itertools</code> va pouvoir nous aider à trouver des solutions plus satisfaisantes.</p>
<h2 id="itertools-for-the-win">Itertools for the win</h2>
<h3 id="et-splat-le-chien">Et splat le chien</h3>
<p>Il est possible de <em>développer</em> une liste ou un de manière plus générale un <code>iterator</code> avec <code>*</code>, le <em>splat operator</em> : <code>*</code> développe un <code>iterator</code> en l&rsquo;ensemble de ces éléments.
Illustrons cela.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">itertools</span>


<span class="n">example_liste</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="s2">&#34;b&#34;</span><span class="p">,</span> <span class="s2">&#34;c&#34;</span><span class="p">,</span> <span class="s2">&#34;d&#34;</span><span class="p">]</span>
<span class="n">example_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">example_iterator</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Une liste exemple :&#34;</span><span class="p">,</span> <span class="n">example_liste</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Une liste exemple développée avec * :&#34;</span><span class="p">,</span> <span class="o">*</span><span class="n">example_liste</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Un intervalle exemple :&#34;</span><span class="p">,</span> <span class="n">example_range</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Un intervalle exemple développée avec * :&#34;</span><span class="p">,</span> <span class="o">*</span><span class="n">example_range</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Un iterateur exemple :&#34;</span><span class="p">,</span> <span class="n">example_iterator</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Un iterateur exemple développée avec * :&#34;</span><span class="p">,</span> <span class="o">*</span><span class="n">example_iterator</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Ce code donne comme affichage :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Une liste exemple : [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]
Une liste exemple développée avec * : a b c d
Un intervalle exemple : range(0, 10)
Un intervalle exemple développée avec * : 0 1 2 3 4 5 6 7 8 9
Un iterateur exemple : &lt;itertools.islice object at 0x000001C9E3EADE00&gt;
Un iterateur exemple développée avec * : 10 11 12 13 14 15 16 17 18 19
</code></pre></td></tr></table>
</div>
</div><p>Cet opérateur <em>splat</em> est bien pratique et va pouvoir être utilisé en conjonction avec une fonction de <code>itertools</code></p>
<h3 id="iterator-unchained">Iterator unchained</h3>
<p>Dans le module <code>itertools</code> il y a la fonction <code>chain</code> qui prend un ou plusieurs <code>iterable</code>s et retourne un <code>iterator</code>.
Cet <code>iterator</code> est en quelque sorte la concaténation des <code>iterable</code>s fournis en entrée de <code>chain</code> : les éléments de chaque <code>iterable</code> sont retournés en les uns après les autres avant de passer à l'<code>iterable</code> suivant.
Un exemple permettra d&rsquo;éclairer mon propos.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">list_0_to_9</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">list_10_to_19</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">list_20_to_25</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Exemple d&#39;utilisation de chain, nombres de 0 à 25 :&#34;</span><span class="p">,</span> <span class="o">*</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">list_0_to_9</span><span class="p">,</span> <span class="n">list_10_to_19</span><span class="p">,</span> <span class="n">list_20_to_25</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Comme on peut le voir ci-après, ces lignes vont provoquer l&rsquo;affichage des nombres de 0 à 25 : <code>chain</code> a produit un <code>iterator</code> qui va d&rsquo;abord retourner les valeurs 0 à 9 provenant de <code>list_0_to_9</code>, puis les valeurs provenant de <code>list_10_to_19</code> et enfin celles provenant de <code>list_20_to_25</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Exemple d&#39;utilisation de chain, nombres de 0 à 25 : 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
</code></pre></td></tr></table>
</div>
</div><p>On notera au passage l&rsquo;utilisation de <code>itertools.islice</code> qui permet de sélectionner un ensemble d&rsquo;éléments d&rsquo;un <code>iterable</code> et <code>itertools.count</code> qui produit un <code>iterator</code> qui retourne des valeurs espacées régulièrement à partir d&rsquo;une valeur de départ (ici l&rsquo;espacement est la valeur par défaut <code>1</code>, pour une valeur de départ valant respectivement <code>10</code> et <code>20</code>).</p>
<p>Armé de <code>*</code> et de <code>chain</code> nous allons pouvoir construire une nouvelle version de <code>flatmap</code> qui retournera cette fois-ci un <code>iterator</code>.</p>
<p>Tout d&rsquo;abord, avant de généraliser à une fonction, voyons comment on peut les utiliser pour constituer la liste des cases de l&rsquo;échiquier.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">chessboard</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
    <span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">rows</span><span class="p">),</span> <span class="n">columns</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Liste des cases de l&#39;échiquier avec map et chain :&#34;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">chessboard</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Cela nous donne bien ce que nous attendons.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Liste des cases de l&#39;échiquier avec map et chain : [(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8), (&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), (&#39;b&#39;, 6), (&#39;b&#39;, 7), (&#39;b&#39;, 8), (&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8), (&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), (&#39;d&#39;, 6), 
(&#39;d&#39;, 7), (&#39;d&#39;, 8), (&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8), (&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 7), (&#39;f&#39;, 
8), (&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8), (&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]
</code></pre></td></tr></table>
</div>
</div><p>En effet, le résultat des 2 <code>maps</code> imbriqués est un <code>iterator</code> produisant lui même des <code>iterator</code>s correspondant respectivement à la colonne des <code>'a'</code>, puis à la colonne des <code>'b'</code> est ainsi de suite.
En appliquant le <em>splat operator</em> <code>*</code> sur ce résultat, l'<code>iterator</code> d'<code>iterator</code>s est développé en une série <code>iterator</code>s, qui sont passés à <code>chain</code> qui produit les éléments de chaque <code>iterator</code> les uns à la suite des autres, passant à l'<code>iterator</code> suivant dès que l'<code>iterator</code> courant est épuisé.</p>
<p>De là il est facile de généraliser à une fonction proposant une nouvelle implémentation de <code>flatmap</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">itertools</span>


<span class="k">def</span> <span class="nf">itertools_flatmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">iterator</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">iterator</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Si nous l&rsquo;appliquons à la génération de la liste des cases de l&rsquo;échiquier</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">chessboard</span> <span class="o">=</span> <span class="n">itertools_flatmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">rows</span><span class="p">),</span> <span class="n">columns</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Liste des cases de l&#39;échiquier avec itertools_flatmap :&#34;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">chessboard</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Cela nous donne bien ici encore ce que nous attendons.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Liste des cases de l&#39;échiquier avec itertools_flatmap : [(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8), (&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), (&#39;b&#39;, 6), (&#39;b&#39;, 7), (&#39;b&#39;, 8), (&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8), (&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), (&#39;d&#39;, 6), (&#39;d&#39;, 7), (&#39;d&#39;, 8), (&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8), (&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 7), (&#39;f&#39;, 8), (&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8), (&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]        
</code></pre></td></tr></table>
</div>
</div><p>Si <code>fun</code> est une fonction retournant un <code>iterable</code>, le résultat de <code>map(fun, iterator)</code> sera un <code>iterator</code> produisant des <code>iterable</code>s. L&rsquo;opérateur <code>*</code> permet de développer l'<code>iterator</code> de <code>iterable</code>s en une série de <code>iterable</code>s ; de là <code>chain</code> produira les valeurs de chacun des <code>iterable</code>s l&rsquo;un à la suite de l&rsquo;autre.</p>
<h3 id="product">Product</h3>
<p>Néanmoins, pour réaliser un produit cartésien comme on le fait dans le cas de la liste des cases de l&rsquo;échiquier, il y a une solution plus simple en exploitant toujours <code>itertools</code> : la fonction <code>product</code> qui réalise le produit cartésiens des <code>iterable</code>s qu&rsquo;on lui fournit en entrée.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">itertools</span>


<span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">chessboard</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Liste des cases de l&#39;échiquier avec product:&#34;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">chessboard</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Cela  donne bien le résultat escompté</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Liste des cases de l&#39;échiquier avec product: [(&#39;a&#39;, 1), (&#39;a&#39;, 2), (&#39;a&#39;, 3), (&#39;a&#39;, 4), (&#39;a&#39;, 5), (&#39;a&#39;, 6), (&#39;a&#39;, 7), (&#39;a&#39;, 8), (&#39;b&#39;, 1), (&#39;b&#39;, 2), (&#39;b&#39;, 3), (&#39;b&#39;, 4), (&#39;b&#39;, 5), 
(&#39;b&#39;, 6), (&#39;b&#39;, 7), (&#39;b&#39;, 8), (&#39;c&#39;, 1), (&#39;c&#39;, 2), (&#39;c&#39;, 3), (&#39;c&#39;, 4), (&#39;c&#39;, 5), (&#39;c&#39;, 6), (&#39;c&#39;, 7), (&#39;c&#39;, 8), (&#39;d&#39;, 1), (&#39;d&#39;, 2), (&#39;d&#39;, 3), (&#39;d&#39;, 4), (&#39;d&#39;, 5), (&#39;d&#39;, 6), (&#39;d&#39;, 
7), (&#39;d&#39;, 8), (&#39;e&#39;, 1), (&#39;e&#39;, 2), (&#39;e&#39;, 3), (&#39;e&#39;, 4), (&#39;e&#39;, 5), (&#39;e&#39;, 6), (&#39;e&#39;, 7), (&#39;e&#39;, 8), (&#39;f&#39;, 1), (&#39;f&#39;, 2), (&#39;f&#39;, 3), (&#39;f&#39;, 4), (&#39;f&#39;, 5), (&#39;f&#39;, 6), (&#39;f&#39;, 7), (&#39;f&#39;, 8), (&#39;g&#39;, 1), (&#39;g&#39;, 2), (&#39;g&#39;, 3), (&#39;g&#39;, 4), (&#39;g&#39;, 5), (&#39;g&#39;, 6), (&#39;g&#39;, 7), (&#39;g&#39;, 8), (&#39;h&#39;, 1), (&#39;h&#39;, 2), (&#39;h&#39;, 3), (&#39;h&#39;, 4), (&#39;h&#39;, 5), (&#39;h&#39;, 6), (&#39;h&#39;, 7), (&#39;h&#39;, 8)]
</code></pre></td></tr></table>
</div>
</div><p>La fonction <code>product</code> est une alternative intéressante à des boucles <code>for</code> imbriquées.
Elle prend un ou plusieurs <code>iterable</code>s en entrée, ainsi qu&rsquo;un paramètre optionnel spécifiant le nombre de répétitions dont la valeur par défaut vaut 1.
Elle mériterait comme la plupart des fonctions de <code>itertools</code> qu&rsquo;on s&rsquo;attarde sur elle mais cela sortirait du cadre de ce billet.
Un sujet pour une autre fois.</p>
<h3 id="ne-pas-confondre-flatmap-et-flatten">Ne pas confondre flatmap et flatten</h3>
<p>Un dernier point, il y a une autre opération classique sur les séquences qui peut faire un peu penser à <code>flatmap</code>, c&rsquo;est <code>flatten</code>.
Elle permet d&rsquo;<em>aplatir</em> une séquence ayant un niveau arbitrairement profond d&rsquo;imbrications.</p>
<p>La fonction <code>flatmap</code> ne réalise effectivement <em>l&rsquo;aplatissement</em> qu&rsquo;au premier niveau d&rsquo;imbrication et cet <em>aplatissement</em> est implicitement fait à la suite de la transformation d&rsquo;un élément de la séquence par une fonction de transformation qui transforme cet élément en une séquence.</p>
<p>La fonction <code>flatten</code> n&rsquo;effectue pas de transformation des éléments, elle se contente de supprimer toutes imbrications dans la séquence.
Ainsi la liste <code>[1,[2,3,4],[5[6,[7]]],8,[[[9]]]]</code> serait transformée en <code>[1,2,3,4,5,6,7,8,9]</code> par une fonction <code>flatten</code>.
Il n&rsquo;existe pas de fonction <code>flatten</code> dans la bibliothèque standard de Python.</p>
<p>Comme pour <code>product</code>, <code>flatten</code> mériterait qu&rsquo;on s&rsquo;y attarde mais cela sortirait du cadre de ce billet.
Là encore, un sujet pour une autre fois.</p>
<h2 id="synthèse">Synthèse</h2>
<p>Ce billet clos une <a href="https://tgits.github.io/post/notes_apprentissage_python_traiter_sequences_avec_style_fonctionnel/">série de billets sur le traitement des séquences avec un style fonctionnel en Python</a> dans laquelle on a abordé <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_filter/">filter</a>, <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_map/">map</a> et <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_reduce/">reduce</a>.</p>
<p>Cela a été l&rsquo;occasion de s&rsquo;attarder sur la fonction <code>flatmap</code> et de regarder comment l&rsquo;implémenter de différentes manières en Python.
Cette exploration en soit contient son propre intérêt, mais il faut reconnaitre qu&rsquo;en Python le besoin de recourir à <code>filter</code>, <code>map</code> et <code>reduce</code> est marginal, Python proposant des alternatives plus idiomatiques.</p>
<p>La fonction <code>flatmap</code> n&rsquo;existe pas en Python en tant que fonction native ou en tant que fonction de la bibliothèque standard. Il est assez facile d&rsquo;un coder une implémentation en s&rsquo;appuyant sur <code>itertools</code> si c&rsquo;est nécessaire, sachant que selon le besoin, <code>itertools</code> a peut-être déjà une solution prête à l&rsquo;emploi.</p>
<p>Les exemples de code du billet sont disponibles dans un <a href="https://gist.github.com/TGITS/fea40fb15589ebccb5a26db4eb5ae271">gist</a>.</p>
<h2 id="ressources">Ressources</h2>
<ul>
<li>Billet chapeau sur le <a href="https://tgits.github.io/post/notes_apprentissage_python_traiter_sequences_avec_style_fonctionnel/">traitement des séquences avec un style fonctionnel</a></li>
<li>Billet sur <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_filter/">filter</a></li>
<li>Billet sur <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_map/">map</a></li>
<li>Billet sur <a href="https://tgits.github.io/post/notes_apprentissage_python_tssf_reduce/">reduce</a></li>
<li><a href="https://gist.github.com/TGITS/fea40fb15589ebccb5a26db4eb5ae271">gist des exemples du billet</a></li>
<li><a href="https://martinfowler.com/articles/collection-pipeline/">Notion de <em>Collection Pipeline</em></a>
<ul>
<li>Avec les <a href="https://martinfowler.com/articles/collection-pipeline/#op-catalog">opérations communes</a> sur ce <em>Collection Pipeline</em> :
<ul>
<li><a href="https://martinfowler.com/articles/collection-pipeline/flat-map.html">flat-map/concat</a></li>
</ul>
</li>
</ul>
</li>
<li>Article <em><a href="https://dev.to/turbaszek/flat-map-in-python-3g98">Flat map in Python</a></em></li>
<li>Article <em><a href="https://dzone.com/articles/python-equivalent-flatmap">Python: Equivalent to flatMap for Flattening an Array of Arrays</a></em></li>
<li><a href="https://rxmarbles.com/">RxJS Marbles</a></li>
<li><a href="https://github.com/ReactiveX/RxPY">RxPy</a></li>
<li><a href="http://reactivex.io/">ReactiveX</a>
<ul>
<li><a href="http://reactivex.io/documentation/operators/flatmap.html">FlatMap</a></li>
</ul>
</li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Auteur</span>
    <span class="item-content">TGITS</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">Modifié</span>
    <span class="item-content">
        2021-05-07
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          <a href="/tags/python3/">python3</a>
          <a href="/tags/notes-dapprentissage/">notes d&#39;apprentissage</a>
          <a href="/tags/d%C3%A9veloppement/">développement</a>
          <a href="/tags/tips/">tips</a>
          <a href="/tags/programmation-fonctionnelle/">programmation fonctionnelle</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/notes_apprentissage_python_tssf_reduce/">
            <span class="next-text nav-default">Notes d&#39;apprentissage de Python : traitement des séquences avec un style fonctionnel - reduce</span>
            <span class="next-text nav-mobile">Suivant</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'thegeekintheshell';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "thegeekintheshell" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<div class="social-links">
      <a href="mailto:thegeekintheshell@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/_TGITS" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.linkedin.com/in/cvaudry/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/TGITS" class="iconfont icon-github" title="github"></a>
      <a href="https://gitlab.com/TGITS" class="iconfont icon-gitlab" title="gitlab"></a>
  <a href="https://tgits.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Propulsé par <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Thème - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">TGITS</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
